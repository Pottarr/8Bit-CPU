\documentclass[12pt]{report}

\usepackage[a4paper, total={6in, 8in}]{geometry}
\usepackage{array}
\usepackage{amsmath, amssymb}
\usepackage{fancyhdr}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{indentfirst}
\usepackage{listings}
\usepackage{lipsum}
\usepackage{minted}
\usepackage{tabularx}
\usepackage{titlesec}
\usepackage{tocloft}

\setlength{\parindent}{1cm}
\setlength{\parskip}{5pt}

\titlespacing*{\chapter}{0pt}{0.5cm}{0.5cm}

\titlespacing*{\section}{0pt}{0.25cm}{0.25cm}

\setlength{\cftbeforetoctitleskip}{1cm}
\setlength{\cftaftertoctitleskip}{1cm}

\begin{document}

\begin{titlepage}
	\centering
	\vspace{1cm}
	\includegraphics[width=0.3\textwidth]{./images/KMITL Logo.png} \\
	\vspace{1cm}
	{\LARGE \textbf{8 Bits CPU Simulation Documentation}} \\[0.5cm]
	\vspace{0.5cm}
	{\large \textbf{Compter Architecture and Organization}} \\[0.5cm]
	{\large \textbf{Software Engineering Program,}} \\[0.5cm]
	{\large \textbf{Department of Computer Engineering,}} \\[0.5cm]
	{\large \textbf{School of Engineering, KMITL}} \\[1cm]
	{\Large 67011093 Chavit Sarutdeechaikul} \\[0.25cm]
    {\Large 67011352 Theepakorn Phayonrat}
\end{titlepage}

% Preface page
\chapter*{Preface}

This project, Design and Implementation of a Minimal 8-Bit CPU, was
undertaken as part of the Computer Architecture and Organization course
in the second year of Bachelor of Software Engineering at KMITL.
It represents a practical exploration of fundamental computer architecture
concepts, from logic design to instruction execution. The project allowed
us to apply theoretical knowledge of CPU structure, instruction sets,
and pipelining into a fully simulated and functioning processor. Using
the Digital simulator by Hneemann, we developed and verified a modular
CPU that embodies the essence of real processor operation. This report
documents the design process, implementation details, and lessons
learned throughout the development cycle.

\newpage

% Abstract page
\chapter*{Abstract}

This mini project focuses on the design and simulation of a minimal
8-bit pipelined CPU using the Digital circuit simulation software.
The CPU incorporates a five-stage pipeline—Fetch, Decode, Execute,
Memory, and Write Back—and supports a custom instruction set architecture
(ISA) with arithmetic, logical, branching, and I/O operations.
The architecture features separate ROM and RAM modules, basic input
and output ports, and a status register for flag management. Through
simulation and test programs, the system demonstrates instruction
execution, branching control, and interrupt handling. The project
enhances understanding of CPU internals, digital logic integration,
and the challenges of pipelined design, offering a hands-on approach 
to fundamental architectural concepts.

\newpage

% Table of contents
\tableofcontents
\newpage

% Chapter 1: Introduction
\chapter{Introduction}
\section{Project Overview}

The 8-Bit CPU Simulation project aims to implement a simplified,
educational model of a pipelined processor that captures the essential
operations of modern CPUs while remaining manageable for simulation.
The design follows a five-stage pipeline (Instruction Fetch,
Instruction Decode, Execute, Memory, Write Back), allowing concurrent 
instruction processing for improved efficiency.

The CPU operates with 8-bit data paths and addresses, includes
general-purpose and a special register (flag status register), and
separates program memory (ROM) from data memory (RAM). A custom
instruction set defines all operations, including data transfer
(LD, ST, MOV), arithmetic and logic (ADD, SUB, MUL, AND, OR, XOR, NOT),
branching (BZ, BNZ, BC, B), and I/O handling (RD, WR). Interrupt support
and optional features such as basic caching or branch prediction may 
extend functionality.

Simulation and verification are performed in Digital, emphasizing
modularity, waveform analysis, and clear documentation.

\newpage

\section{Background}

Central Processing Units (CPUs) are the computational core of digital
systems, responsible for executing instructions and managing data flow
between memory and peripherals. Understanding how a CPU functions—from
fetching an instruction to writing back results—is crucial in computer
engineering education.

Traditional classroom learning often focuses on theoretical aspects
such as microarchitecture, ISA design, and pipelining, but lacks
direct visualization of hardware behavior. This project bridges that
gap by using the Digital simulator to implement a CPU from basic logic
components. By designing each pipeline stage, students explore how
control signals, registers, buses, and memory interact to form a
functioning processor.

The project serves as a foundational experience in CPU design, 
illustrating key topics such as instruction decoding, data hazards,
memory access timing, and modular circuit organization.


\section{Objective}

\begin{enumerate}
    \item \textbf{To design and implement} an 8-bit pipelined CPU with a custom instruction set architecture (ISA) using the \textit{Digital} simulation environment.
    \item \textbf{To apply theoretical concepts} of CPU architecture, including pipeline stages, ALU operations, branching, and flag management, in a practical design.
    \item \textbf{To develop modular circuit components} (e.g., ALU, control unit, registers, and memory interfaces) that integrate seamlessly within the pipeline.
    \item \textbf{To simulate and verify} the CPU’s operation through test programs demonstrating arithmetic, logic, branching, stack, and interrupt handling.
    \item \textbf{To enhance understanding} of digital logic design, data path organization, and hardware–software interaction in CPU execution.
    \item \textbf{To document} the architecture, instruction formats, and verification results clearly and comprehensively for academic evaluation.
\end{enumerate}

\chapter{Project Overview}
\section{Hardware Design}

\subsection{Structure}


\includegraphics[width=0.6\textwidth]{images/app_overview.png}

\newpage

\subsection{Pipeline States}

\subsection{Pipeline Hazards Management}

\newpage

\section{Software Design}

\subsection{Instructions}

\noindent Instruction Format (Length: 20 bits): \\
$$Opcode [19:15]\ |\ IMM_{Flag} [14]\ |\ R_{Dest}\ [13:11]\ |\ R_{Src1}\ |\ R_{Src2} [2:0]\ or\ IMM [7:0]$$

\begin{center}
\scalebox{0.6}{
\[
\setlength{\extrarowheight}{5pt} % Adds 5pt to each row's height
\begin{array}{|l|l|l|}
\hline
\textbf{Instruction} & \textbf{Opcode + Fields} & \textbf{Description} \\[4pt]
\hline
\text{Do in } IF & & \\
NOP & 00000\ |\ IMM_{Flag} [14]\ |\ DC[13:0] & \text{No Operation} \\[4pt]
\hline
\text{Do in } EX_{ALU} & & \\
ADD & 00100\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_{Src1} [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Addition} \\[4pt]
SUB & 00101\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_{Src1} [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Subtraction} \\[4pt]
MUL & 00110\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_{Src1} [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Multiplication} \\[4pt]
AND & 01000\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_{Src1} [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Bitwise AND} \\[4pt]
OR  & 01001\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_{Src1} [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Bitwise OR} \\[4pt]
XOR & 01010\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_{Src1} [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Bitwise XOR} \\[4pt]
NOT & 01011\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ DC [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Bitwise NOT} \\[4pt]
\hline
\text{Do in } EX_{JUMP} & & \\
BC & 10000\ |\ IMM_{Flag} [14]\ |\ DC [13:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Branch if Carry} \\[4pt]
BZ  & 10001\ |\ IMM_{Flag} [14]\ |\ DC [13:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Branch if Zero} \\[4pt]
BNZ & 10010\ |\ IMM_{Flag} [14]\ |\ DC [13:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Branch if Not Zero} \\[4pt]
BNG & 10011\ |\ IMM_{Flag} [14]\ |\ DC [13:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Branch if Negative} \\[4pt]
B & 10100\ |\ IMM_{Flag} [14]\ |\ DC [13:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Unconditional Branch} \\[4pt]
\hline
\text{Do in } ME_{Stack} & & \\
PSH & 10110\ |\ DC [14:3]\ |\ R_{Src2} [2:0] & \text{Push } R_{Src2} \text{ value into Stack} \\[4pt]
POP & 10111\ |\ DC [14:3]\ |\ R_{Src2} [2:0] & \text{Pop the top register value from the Stack} \\[4pt]
\hline
\text{Do in } ME_{I/O} & & \\
RD  & 11000\ |\ DC [14:3]\ |\ R_{Src2} [2:0] & \text{Read input value to register} \\[4pt]
WR  & 11001\ |\ DC [14:3]\ |\ R_{Src2} [2:0] & \text{Write value from register to output} \\[4pt]
\hline
\text{Do in } ME_{RAM} & & \\
LD & 11100\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ DC [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Load value from memory to register} \\[4pt]
ST & 11101\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ DC [10:8]\ |\ R_{Src2} [2:0]\ or\ \#IMM [7:0] & \text{Store register to memory} \\[4pt]
\hline
\text{Do in } WB & & \\
MOV & 11110\ |\ IMM_{Flag} [14]\ |\ R_{Dest} [13:11]\ |\ R_src1 [2:0]\ or\ #IMM [7:0] & \text{Move value from} R_{Src1} \text{ or } \#IMM \text{ into } R_{Src1} \\[4pt]
\hline
\end{array}
\]
}
\end{center}

\newpage

\subsection{Assembler}

We had written an assembler in Python. \\

\inputminted[fontsize=\scriptsize, breaklines, breakanywhere, breakindent=1em]{py}{../test/converter.py}

\newpage

\chapter{Installation and Execution Guide}

\section{Prerequisites}
\begin{itemize}
    \item Have git install in your system
    \item Have Hneemann's Digital installed in your system
\end{itemize}

\section{Git Clone from the Remote Repository}
\begin{lstlisting}[language=Bash ,basicstyle=\footnotesize\ttfamily]
git clone https://github.com/Pottarr/8Bit-CPU
\end{lstlisting}

After that you can open the \texttt{CPU.dig} in through your Digital.

% Chapter 4: Summary
\chapter{Summary}
\section{Learning Outcomes}
\begin{itemize}
    \item We have learnt fundamental of concepts of creating good UX and UI.
    \item We have learnt how to develop multi-platform application using C++ Qt.
    \item We have learnt the workflow of project developing.
    \item We have learnt how to use Version Control to help developing application.
\end{itemize}

\section{Accomplishment}
We have created a user friendly multi-platform music player application.

\newpage

% References/Bibliography section
\chapter{References}
% Include your references here in the proper LaTeX format, or use a BibTeX file
\begin{itemize}
    \item AHhhhhhhhhhhhhhhhhhhhhhhhhhh

\end{itemize}

\newpage

\chapter{Appendix}

\section{Github Repositories}
\noindent \url{https://github.com/Pottarr/8Bit-CPU} \\
\noindent \url{https://github.com/hneemann/Digital} \\

\end{document}
